---
title: "dtwSat"
author: "Victor Maus"
date: "`r Sys.Date()`"
output:
  md_document:
    variant: markdown_github
bibliography: ./vignettes/references.bib
---

<!-- 
# Render README.md file  
rmarkdown::render("README.Rmd")
-->

dtwSat
=====

### Time-Weighted Dynamic Time Warping for remote sensing time series analysis
dtwSat provides an implementation of Time-Weighted Dynamic Time Warping (TWDTW) for satellite image time series analysis and land use classification. It is useful to account for natural and cultivated vegetation types with inter-annual climatic and seasonal variability. Methods based on dynamic time warping are flexible to handle with irregular sampling and out of phase time series, and have achieved significant results in time series data mining. Bellow we show a quick demo of the package and a vignette for land use mapping using satellite image time series.

### Install
```{r installation, eval = FALSE}
devtools::install_github("vwmaus/dtwSat")
```

### Quick demo

This dome performs the TWDTW analysis for the following `template` time series
```{r plot-template-ts, echo = TRUE, eval = TRUE, fig.path='figure/', fig.width=6, fig.height=6, fig.align='center', fig.cap='Typical temporal patterns.', warning = FALSE, message = FALSE}
library(dtwSat)
library(ggplot2)
autoplot(template, facets = NULL) + 
     theme(text = element_text(size = 8, family = "Helvetica"))
```
whose subintervals we want to classify into one of the following crop types
```{r plot-patterns, echo = TRUE, eval = TRUE, fig.path='figure/', fig.width=6, fig.height=6, fig.align='center', fig.cap='Typical temporal patterns.', warning = FALSE, message = FALSE}
plotPatterns(patterns.list) + 
     theme(text = element_text(size = 8, family = "Helvetica"))
```

Therefore, we apply the TWDTW analysis using a logistic time-weight
```{r perform-twdtw, echo = TRUE, eval = TRUE, results = "hide", warning = FALSE, message = FALSE}
weight.fun = logisticWeight(alpha=-0.1, beta=100)
alig = twdtw(x=template.list[[1]], patterns=patterns.list, 
             normalize.patterns = TRUE, patterns.length = 23,
             weight.fun = weight.fun, keep=TRUE) 
```
that retrieves an `twdtw` object with all possible alignments of the patterns to the template time series 
```{r show-twdtw, echo = TRUE, eval = TRUE, results = "hide", warning = FALSE, message = FALSE}
class(alig)
print(alig)
summary(alig)
```

We can use several plot methods to visualize the resulting `twdtw` object. To plot alignments 
```{r plot-alignment, echo = TRUE, eval = TRUE, fig.path='figure/', fig.width=6, fig.height=6, fig.align='center', fig.cap='Typical temporal patterns.', warning = FALSE, message = FALSE}
plot(x = alig, type = "alignment") + 
     theme(text = element_text(size = 8, family = "Helvetica"))
```
to plot matching point 
```{r plot-match, echo = TRUE, eval = TRUE, fig.path='figure/', fig.width=6, fig.height=6, fig.align='center', fig.cap='Typical temporal patterns.', warning = FALSE, message = FALSE}
plot(x = alig, type = "match", attr = "evi") + 
     theme(text = element_text(size = 8, family = "Helvetica"))
```
to plot minimum cost paths 
```{r plot-path, echo = TRUE, eval = TRUE, fig.path='figure/', fig.width=6, fig.height=6, fig.align='center', fig.cap='Typical temporal patterns.', warning = FALSE, message = FALSE}
plot(type = "path", x = alig) + 
     theme(text = element_text(size = 8, family = "Helvetica"))
```
or to classify and plot each subinterval of the template time series 
```{r plot-group, echo = TRUE, eval = TRUE, fig.path='figure/', fig.width=6, fig.height=6, fig.align='center', fig.cap='Typical temporal patterns.', warning = FALSE, message = FALSE}
plot(x = alig, type = "group",
     from = "2009-09-01", to = "2013-09-01", 
     by = "6 month", overlap = 0.3) + 
     theme(text = element_text(size = 8, family = "Helvetica"))
```


Vignette - Land use classification using dtwSat
=====
```{r child = 'vignettes/lucc.Rmd'}
```

