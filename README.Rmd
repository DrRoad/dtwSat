---
output:
  md_document:
    variant: markdown_github
---

<!-- 
# Edit and run 
library(knitr)
knit(input="README.Rmd", output = "README.md")
-->

dtwSat
=====

### Time-Weighted Dynamic Time Warping for remote sensing time series analysis
dtwSat provides a Time-Weighted Dynamic Time Warping (TWDTW) algorithm to measure similarity between two temporal sequences. This adaptation of the classical Dynamic Time Warping (DTW) algorithm is flexible to compare events that have a strong time dependency, such as phenological stages of cropland systems and tropical forests. 

### Install
```{r installation, eval = FALSE}
devtools::install_github("vwmaus/dtwSat")
```


### Quick demo

This dome performs a dtwSat analysis and show the results.
```{r define-demo-plot-dtwSat, eval=TRUE, include = TRUE}
library(dtwSat, quietly = TRUE)
names(patterns.list)

weight.fun = logisticWeight(alpha=-0.1, beta=100, theta=0.5)

alig = twdtw(patterns=patterns.list, 
             timeseries=waveletSmoothing(timeseries=template), 
             weight.fun = weight.fun, span=180, keep=TRUE) 

is(alig, "dtwSat")
print(alig)
summary(alig)
```

### Plot examples

Plot matching points 
```{r define-demo-plot-matches, eval=TRUE, include = TRUE}
library(dtwSat, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(gridExtra, quietly = TRUE)
alig = twdtw(patterns=patterns.list, timeseries=waveletSmoothing(timeseries=template), 
             weight.fun = logisticWeight(alpha=-0.1, beta=100, theta=0.5), 
             normalize.patterns=TRUE, patterns.length=23, span=180, keep=TRUE)

gp1 = plot(alig, type="match") + 
          ggtitle("Best alignment for each class") +
		      theme(axis.title.x=element_blank()) 
gp2 = plot(alig, type="match", p.names=rep("Soybean",4), n=1:4) +
          ggtitle("The four best alignments of Soybean") 
grid.arrange(gp1,gp2,nrow=2)
```


Plot alignments
```{r define-demo-plot-alignments, eval=TRUE, include = TRUE}
library(dtwSat, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(gridExtra, quietly = TRUE)
alig = twdtw(patterns=patterns.list, timeseries=template, 
             weight.fun = logisticWeight(alpha=-0.1, beta=100, theta=0.5), 
             normalize.patterns=TRUE, patterns.length=23, span=180, keep=TRUE)

gp = plot(alig, attr=c("evi","ndvi"), type="alignment", threshold=4)
grid.arrange(gp)
```


Plot path for DTW (top) and TWDTW (bottom)
```{r define-demo-twdtw-x-dtw, eval=TRUE, include = TRUE}
library(dtwSat, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(gridExtra, quietly = TRUE)
alig1 = twdtw(patterns=patterns.list, timeseries=template, 
              normalize.patterns=TRUE, patterns.length=23, span=180, keep=TRUE)
alig2 = twdtw(patterns=patterns.list, timeseries=template, 
              weight.fun = logisticWeight(alpha=-0.1, beta=100, theta=0.5), 
              normalize.patterns=TRUE, patterns.length=23, span=180, keep=TRUE)

gp1 = plot(alig1, p.name="Soybean", show.dist = TRUE) + ggtitle("DTW") 
gp2 = plot(alig3, p.name="Soybean", show.dist = TRUE) + ggtitle("TWDTW") 
grid.arrange(gp1, gp2, ncol=1)
```

Plot path for all classese
```{r define-demo-plot-paths, eval=TRUE, include = TRUE}
library(dtwSat, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(gridExtra, quietly = TRUE)
alig = twdtw(patterns=patterns.list, timeseries=template, 
             weight.fun = logisticWeight(alpha=-0.1, beta=100, theta=0.5), 
             normalize.patterns=TRUE, patterns.length=23, span=180, keep=TRUE)

gp = plot(alig, n.alignments=1:4, show.dist=TRUE)
grid.arrange(gp)
```

Compare DTW and TWDTW classification
```{r define-demo-plot-classification, eval=TRUE, include = TRUE}
library(dtwSat, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(gridExtra, quietly = TRUE)

alig1 = twdtw(patterns=patterns.list, timeseries=template, 
              normalize.patterns=TRUE, patterns.length=23, span=180, keep=TRUE)

alig2 = twdtw(patterns=patterns.list, timeseries=template, 
              weight.fun = logisticWeight(alpha=-0.1, beta=100, theta=0.5), 
              normalize.patterns=TRUE, patterns.length=23, span=180, keep=TRUE)
 
gp1 = plot(alig1, type="group", from=as.Date("2009-09-01"),  
           to=as.Date("2013-09-01"), by = "6 month", overlap=.3) + 
           ggtitle("DTW") 

gp2 = plot(alig2, type="group", from=as.Date("2009-09-01"), 
           to=as.Date("2013-09-01"), by = "6 month", overlap=.3) + 
           ggtitle("TWDTW") 

grid.arrange(gp1, gp2, ncol=1)
```


Plot wavelet smoothing
```{r define-demo-plot-smoothing, eval=TRUE, include = TRUE}
library(dtwSat, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(gridExtra, quietly = TRUE)
sy = waveletSmoothing(timeseries=template, frequency=8, wf = "la8", J=1, 
                      boundary = "periodic")

gp1 = autoplot(sy, facets = NULL) + xlab("Time") + ylab("Value")

evi = merge(Raw=zoo(template$evi), Wavelet=zoo(sy$evi))

gp2 = autoplot(evi, facets = NULL) + xlab("Time") + ylab("EVI")

grid.arrange(gp1,gp2,nrow=2)
```



```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```
